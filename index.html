<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Menu (Filtros com ‚Äúefeito Apple‚Äù) + Looker embed</title>
  <style>
    :root{
      --sidebar-w: 280px;
      --sidebar-w-collapsed: 76px;
      --bg: 12 16 32;       /* #0b1020 */
      --ink: 229 231 235;   /* #e5e7eb */
      --muted: 148 163 184; /* #94a3b8 */
      --accent: 34 197 94;  /* #22c55e */
      --stroke: 31 41 55;   /* #1f2937 */
    }
    *{ box-sizing: border-box }
    html,body{ height:100%; margin:0 }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial;
      color: rgb(var(--ink));
      background: rgb(11 16 32);
    }

    /* ----- LAYOUT -------------------------------------------------------- */
    .app{
      display:grid;
      grid-template-columns: var(--sidebar-w) 1fr;
      height: 100dvh;
      transition: grid-template-columns .28s cubic-bezier(.2,.8,.2,1);
      overflow: hidden;
    }
    .app.collapsed{ grid-template-columns: var(--sidebar-w-collapsed) 1fr }

    /* ----- SIDEBAR (vidro + eleva√ß√£o sutil) ----------------------------- */
    .sidebar{
      padding:16px 12px;
      display:flex; flex-direction:column; gap:12px;
      border-right:1px solid rgb(var(--stroke)/.6);
      background: linear-gradient(180deg, rgb(15 23 42/.55), rgb(17 24 39/.55));
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      box-shadow: 0 10px 30px rgb(0 0 0 / .25);
    }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px }
    .dot{ width:12px; height:12px; border-radius:999px; background: rgb(var(--accent)) }

    .toggle{
      width:100%; border:0; cursor:pointer;
      padding:10px 12px; border-radius:12px;
      color: rgb(var(--ink));
      background: rgb(31 41 55 / .85);
      transition: transform .14s ease, background .25s ease, box-shadow .25s ease;
      box-shadow: 0 6px 14px rgb(0 0 0 / .18) inset, 0 1px 0 rgb(255 255 255 / .05);
    }
    .toggle:hover{ background: rgb(40 50 70 / .9) }
    .toggle:active{ transform: scale(.985) }

    .hint{ font-size:12px; color: rgb(var(--muted)) }

    /* ----- MENU ITEMS ---------------------------------------------------- */
    .menu{ display:grid; gap:6px; margin-top:2px }
    .menu a, .menu button.item{
      display:grid; grid-template-columns: 28px 1fr 22px; align-items:center; gap:10px;
      padding:10px 10px; border-radius:12px; border:0; cursor:pointer;
      background: transparent; color: rgb(var(--ink)); text-decoration:none;
      transition: background .2s ease, transform .12s ease;
    }
    .menu a:hover, .menu button.item:hover{ background: rgb(31 41 55 / .6) }
    .menu a:active, .menu button.item:active{ transform: scale(.985) }
    .icon{ text-align:center; font-size:18px }
    .label{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .caret{ opacity:.7; transition: transform .28s cubic-bezier(.2,.8,.2,1) }

    /* ----- ACCORDION (Apple-like) --------------------------------------- */
    .submenu{
      overflow: hidden;
      height: 0;            /* fechado por padr√£o */
      border-left: 1px dashed rgb(var(--stroke)/.6);
      margin-left: 14px;
      padding-left: 18px;
      will-change: height;
    }
    .row{
      display:flex; align-items:center; gap:10px;
      padding:8px 6px; border-radius:10px;
      transform: translateY(-6px);
      opacity:0;
    }
    .row:hover{ background: rgb(30 41 59 / .55) }
    .submenu input[type="radio"]{ accent-color: rgb(var(--accent)) }

    .actions{ display:flex; gap:8px; margin:8px 0 12px }
    .btn{
      border:0; cursor:pointer; font-weight:700;
      padding:9px 12px; border-radius:12px;
      background: rgb(var(--accent)); color:#06110b;
      box-shadow: 0 6px 14px rgb(34 197 94 / .22);
      transition: transform .12s ease, filter .2s ease;
    }
    .btn:hover{ filter: brightness(1.05) }
    .btn:active{ transform: translateY(1px) }
    .btn.secondary{ background: rgb(31 41 55); color: rgb(var(--ink)); box-shadow:none }

    /* Estado visual do cabe√ßalho do accordion */
    .item[aria-expanded="true"] .caret{ transform: rotate(180deg) }

    /* Colapso global */
    .app.collapsed .label,
    .app.collapsed .caret,
    .app.collapsed .submenu{ display:none !important }
    .app.collapsed .menu{ gap:10px }
    .app.collapsed .menu a, .app.collapsed .menu button.item{ grid-template-columns:1fr; justify-items:center }

    /* ----- STAGE (relat√≥rio) ------------------------------------------- */
    .stage{ position:relative; height:100%; background: rgb(var(--bg)) }
    .report-frame{ position:absolute; inset:0; width:100%; height:100%; border:0; background: rgb(var(--bg)) }

    /* Acessibilidade: reduzir movimento */
    @media (prefers-reduced-motion: reduce){
      .caret, .toggle, .menu a, .menu button.item{ transition:none }
    }
    small.note{ color: rgb(var(--muted)); display:block; margin-top:6px }
  </style>
</head>
<body>
  <div id="app" class="app">
    <aside class="sidebar" role="navigation" aria-label="Menu lateral">
      <div class="brand"><span class="dot"></span><span class="label">Menu</span></div>

      <button class="toggle" type="button" onclick="toggleSidebar(this)" aria-expanded="true">
        ‚ò∞ <span class="label">Colapsar/Expandir</span>
      </button>

      <div class="hint"><span class="label">Filtros com anima√ß√£o suave</span></div>

      <nav class="menu">
        <a href="#home"><span class="icon">üè†</span><span class="label">Home</span><span class="caret"></span></a>

        <!-- ====== Filtro (Accordion) ====== -->
        <button class="item" type="button" aria-expanded="false" aria-controls="sub-filtros" onclick="toggleAccordion(this, 'sub-filtros')">
          <span class="icon">üîé</span><span class="label">Filtros</span><span class="caret">‚ñæ</span>
        </button>

        <div id="sub-filtros" class="submenu" role="region" aria-label="Filtros">
          <label class="row"><input type="radio" name="filtro-nome" value="FABIO AMARAL"><span class="label">FABIO AMARAL</span></label>
          <label class="row"><input type="radio" name="filtro-nome" value="GABRIEL SOUZA"><span class="label">GABRIEL SOUZA</span></label>
          <label class="row"><input type="radio" name="filtro-nome" value="MARCELO ALFREDO"><span class="label">MARCELO ALFREDO</span></label>
          <label class="row"><input type="radio" name="filtro-nome" value="ROMULO SALLA"><span class="label">ROMULO SALLA</span></label>
          <label class="row"><input type="radio" name="filtro-nome" value="TAINA SANTORO"><span class="label">TAINA SANTORO</span></label>

          <div class="actions">
            <button class="btn" type="button" onclick="aplicarFiltro()">Filtrar</button>
            <button class="btn secondary" type="button" onclick="limparFiltro()">Limpar</button>
          </div>
          <small class="note">Envia para o embed: <code>ds56.param_responsaveis</code> como array (ex.: <code>["FABIO AMARAL"]</code>).</small>
        </div>
        <!-- ====== /Filtro ====== -->

      </nav>
    </aside>

    <section class="stage" aria-label="√Årea do relat√≥rio">
      <iframe
        id="reportFrame"
        class="report-frame"
        src="https://lookerstudio.google.com/embed/reporting/05f69128-cdfd-4e58-b570-1a6a54a25830/page/p_ronkgricwd"
        frameborder="0"
        allowfullscreen
        sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox">
      </iframe>
    </section>
  </div>

  <script>
    /* ================== CONFIG ================== */
    const PARAM_NAME = "ds56.param_responsaveis";
    const BASE_EMBED_URL = "https://lookerstudio.google.com/embed/reporting/05f69128-cdfd-4e58-b570-1a6a54a25830/page/p_ronkgricwd";
    const SEND_AS_ARRAY = true; // mant√©m o padr√£o do seu exemplo
    /* ============================================ */

    // Apple-like accordion: anima altura + ‚Äúreveal‚Äù dos itens com leve elasticidade
    const SPRING_EASE = 'cubic-bezier(.34,1.56,.64,1)';     // leve overshoot
    const SOFT_EASE   = 'cubic-bezier(.2,.8,.2,1)';

    function prefersReducedMotion(){
      return window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    }

    function toggleSidebar(btn){
      const app = document.getElementById('app');
      const isCollapsed = app.classList.toggle('collapsed');
      btn.setAttribute('aria-expanded', String(!isCollapsed));
    }

    function toggleAccordion(headerBtn, panelId){
      const panel = document.getElementById(panelId);
      const isOpen = headerBtn.getAttribute('aria-expanded') === 'true';
      headerBtn.setAttribute('aria-expanded', String(!isOpen));

      if (prefersReducedMotion()){
        panel.style.height = isOpen ? '0px' : 'auto';
        if (!isOpen){
          // marcar vis√≠veis
          panel.querySelectorAll('.row').forEach(r => { r.style.opacity = 1; r.style.transform = 'none'; });
        }
        return;
      }

      // Medir conte√∫do
      const startHeight = panel.offsetHeight;
      panel.style.height = 'auto';
      const endHeight = panel.scrollHeight;
      // Reset para animar a partir do valor atual
      panel.style.height = startHeight + 'px';

      // Stagger das linhas (reveal)
      const rows = Array.from(panel.querySelectorAll('.row'));
      if (!isOpen){
        rows.forEach((row, i) => {
          row.animate(
            [
              { opacity: 0, transform: 'translateY(-8px)' },
              { opacity: 1, transform: 'translateY(0)' }
            ],
            { duration: 240, delay: 25*i, easing: SOFT_EASE, fill: 'forwards' }
          );
        });
      }

      // Anima a altura (com leve elasticidade na abertura)
      const anim = panel.animate(
        [{ height: startHeight + 'px' }, { height: (isOpen ? 0 : endHeight) + 'px' }],
        { duration: isOpen ? 240 : 320, easing: isOpen ? SOFT_EASE : SPRING_EASE, fill: 'forwards' }
      );

      anim.onfinish = () => {
        if (isOpen){
          panel.style.height = '0px';
          // esconder rows visualmente para pr√≥xima abertura
          rows.forEach(r => { r.style.opacity = 0; r.style.transform = 'translateY(-6px)'; });
        } else {
          panel.style.height = 'auto';
        }
      };
    }

    function getNomeSelecionado(){
      const sel = document.querySelector('input[name="filtro-nome"]:checked');
      return sel ? sel.value : null;
    }

    function buildEmbedUrl(base, paramsObj){
      const url = new URL(base);
      url.searchParams.set('params', JSON.stringify(paramsObj));
      return url.toString();
    }

    function aplicarFiltro(){
      const nome = getNomeSelecionado();
      if (!nome){
        alert('Selecione um nome para filtrar.');
        return;
      }
      const value = SEND_AS_ARRAY ? [nome] : nome;
      const paramsObj = { [PARAM_NAME]: value };

      const iframe = document.getElementById('reportFrame');
      const finalUrl = buildEmbedUrl(BASE_EMBED_URL, paramsObj);
      iframe.src = finalUrl;
    }

    function limparFiltro(){
      document.querySelectorAll('input[name="filtro-nome"]').forEach(r => r.checked = false);
      const iframe = document.getElementById('reportFrame');
      iframe.src = BASE_EMBED_URL;
    }
  </script>
</body>
</html>
