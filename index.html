<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gest√£o Training BI ‚Äî Menu + Looker (Responsivo + Filtro padr√£o)</title>
  <style>
    :root{
      /* LARGURAS RESPONSIVAS (escala bem em telas grandes e pequenas) */
      --sidebar-w: clamp(260px, 22vw, 360px);
      --sidebar-w-collapsed: clamp(64px, 7vw, 96px);

      /* TIPOGRAFIA RESPONSIVA */
      --fs-body: clamp(14px, 1.05vw, 16px);
      --fs-small: clamp(12px, 0.9vw, 14px);
      --fs-icon: clamp(18px, 1.4vw, 20px);

      /* CORES */
      --ink: 229 231 235;   /* #e5e7eb */
      --muted: 148 163 184; /* #94a3b8 */
      --accent: 34 197 94;  /* #22c55e */
      --stroke: 31 41 55;   /* #1f2937 */
      --bg: 12 16 32;       /* #0b1020 */
    }

    *{ box-sizing: border-box }
    html,body{ height:100%; margin:0 }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial;
      color: rgb(var(--ink));
      background: rgb(var(--bg));
      font-size: var(--fs-body);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }

    /* ===== Layout ===== */
    .app{
      display:grid;
      grid-template-columns: var(--sidebar-w) 1fr;
      height: 100dvh;
      transition: grid-template-columns .28s cubic-bezier(.2,.8,.2,1);
      overflow: hidden;
    }
    .app.collapsed{ grid-template-columns: var(--sidebar-w-collapsed) 1fr }

    /* ===== Sidebar ===== */
    .sidebar{
      padding:16px 12px;
      display:flex; flex-direction:column; gap:14px;
      border-right:1px solid rgb(var(--stroke)/.6);
      background: linear-gradient(180deg, rgb(15 23 42/.55), rgb(17 24 39/.55));
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      box-shadow: 0 10px 30px rgb(0 0 0 / .25);
    }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px }
    .brand .title{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }

    .toggle{
      width:100%; border:0; cursor:pointer;
      padding:10px 12px; border-radius:12px;
      color: rgb(var(--ink));
      background: rgb(31 41 55 / .85);
      transition: transform .14s ease, background .25s ease, box-shadow .25s ease;
      box-shadow: 0 6px 14px rgb(0 0 0 / .18) inset, 0 1px 0 rgb(255 255 255 / .05);
    }
    .toggle:hover{ background: rgb(40 50 70 / .9) }
    .toggle:active{ transform: scale(.985) }
    .toggle:focus-visible{ outline: 2px solid rgb(var(--accent)); outline-offset: 2px }

    /* ===== Menu ===== */
    .menu{ display:grid; gap:8px; margin-top:2px }
    .menu a, .menu button.item{
      display:grid; grid-template-columns: 28px 1fr 22px; align-items:center; gap:10px;
      padding:10px; border-radius:12px; border:0; cursor:pointer;
      background: transparent; color: rgb(var(--ink)); text-decoration:none;
      transition: background .2s ease, transform .12s ease;
    }
    .menu a:hover, .menu button.item:hover{ background: rgb(31 41 55 / .6) }
    .menu a:active, .menu button.item:active{ transform: scale(.985) }
    .menu a:focus-visible, .menu button.item:focus-visible{ outline: 2px solid rgb(var(--accent)); outline-offset: 2px }
    .icon{ text-align:center; font-size: var(--fs-icon) }
    .label{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .caret{ opacity:.7; transition: transform .28s cubic-bezier(.2,.8,.2,1) }
    .item[aria-expanded="true"] .caret{ transform: rotate(180deg) }

    /* ===== Accordion ===== */
    .submenu{
      overflow: hidden;
      height: 0;                 /* fechado por padr√£o; abriremos via JS */
      border-left: 1px dashed rgb(var(--stroke)/.6);
      margin-left: 14px;
      padding-left: 18px;
      will-change: height;
    }
    /* Subn√≠vel (para "Respons√°veis" dentro de "Filtros") */
    .submenu .submenu{
      margin-left: 12px;
      border-left-style: solid;
      border-left-color: rgb(var(--stroke)/.5);
    }

    .submenu .row{
      display:flex; align-items:center; gap:10px;
      padding:8px 6px; border-radius:10px;
      transform: translateY(-6px);
      opacity:0;
    }
    .submenu .row:hover{ background: rgb(30 41 59 / .55) }
    .submenu input[type="radio"]{ accent-color: rgb(var(--accent)) }

    .submenu .links a{
      display:flex; align-items:center; gap:8px;
      padding:8px 6px; border-radius:10px; text-decoration:none; color: rgb(var(--ink));
      transform: translateY(-6px);
      opacity:0;
    }
    .submenu .links a:hover{ background: rgb(30 41 59 / .55) }

    .actions{ display:flex; gap:8px; margin:8px 0 12px }
    .btn{
      border:0; cursor:pointer; font-weight:700;
      padding:9px 12px; border-radius:12px;
      background: rgb(var(--accent)); color:#06110b;
      box-shadow: 0 6px 14px rgb(34 197 94 / .22);
      transition: transform .12s ease, filter .2s ease;
      font-size: var(--fs-body);
    }
    .btn:hover{ filter: brightness(1.05) }
    .btn:active{ transform: translateY(1px) }
    .btn:focus-visible{ outline: 2px solid rgb(var(--accent)); outline-offset: 2px }
    .btn.secondary{ background: rgb(31 41 55); color: rgb(var(--ink)); box-shadow:none }

    /* Colapso global da sidebar */
    .app.collapsed .label,
    .app.collapsed .caret,
    .app.collapsed .submenu{ display:none !important }
    .app.collapsed .menu{ gap:10px }
    .app.collapsed .menu a, .app.collapsed .menu button.item{ grid-template-columns:1fr; justify-items:center }

    /* ===== Stage (relat√≥rio) ===== */
    .stage{ position:relative; height:100%; background: rgb(var(--bg)) }
    .report-frame{ position:absolute; inset:0; width:100%; height:100%; border:0; background: rgb(var(--bg)) }

    /* Loading overlay (UX) */
    .loading{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,.25); backdrop-filter: blur(2px);
      font-weight:700; letter-spacing:.2px; font-size: var(--fs-body);
    }

    /* Melhor legibilidade em telas muito largas */
    @media (min-width: 1920px){
      .menu a, .menu button.item{ padding:12px }
    }

    @media (prefers-reduced-motion: reduce){
      .caret, .toggle, .menu a, .menu button.item{ transition:none }
    }
  </style>
</head>
<body>
  <div id="app" class="app">
    <aside class="sidebar" role="navigation" aria-label="Menu lateral">
      <div class="brand">
        <span class="title">Gest√£o Training BI</span>
      </div>

      <button class="toggle" type="button" onclick="toggleSidebar(this)" aria-expanded="true">
        ‚ò∞ <span class="label">Colapsar/Expandir</span>
      </button>

      <nav class="menu">
        <!-- ===== DAILY ===== -->
        <button class="item" type="button" aria-expanded="true" aria-controls="sub-daily" onclick="toggleAccordion(this, 'sub-daily')">
          <span class="icon">üóìÔ∏è</span><span class="label">Daily</span><span class="caret">‚ñæ</span>
        </button>
        <div id="sub-daily" class="submenu" role="region" aria-label="Daily">
          <div class="links">
            <a href="#projetos">üìÅ <span class="label">Projetos</span></a>
            <a href="#tickets">üé´ <span class="label">Tickets</span></a>
            <a href="#backlog">üß± <span class="label">Backlog</span></a>
          </div>
        </div>

        <!-- ===== REPORTS ===== -->
        <button class="item" type="button" aria-expanded="true" aria-controls="sub-reports" onclick="toggleAccordion(this, 'sub-reports')">
          <span class="icon">üìä</span><span class="label">Reports</span><span class="caret">‚ñæ</span>
        </button>
        <div id="sub-reports" class="submenu" role="region" aria-label="Reports">
          <div class="links">
            <a href="#review">üßæ <span class="label">Review</span></a>
            <a href="#monthly">üìÖ <span class="label">Monthly</span></a>
            <a href="#quarter">üìÜ <span class="label">Quarter</span></a>
          </div>
        </div>

        <!-- ===== FILTROS ===== -->
        <button class="item" type="button" aria-expanded="true" aria-controls="sub-filtros" onclick="toggleAccordion(this, 'sub-filtros')">
          <span class="icon">üîé</span><span class="label">Filtros</span><span class="caret">‚ñæ</span>
        </button>
        <div id="sub-filtros" class="submenu" role="region" aria-label="Filtros">
          <!-- Subitem: Respons√°veis (N√çVEL INTERNO) -->
          <button class="item" type="button" aria-expanded="true" aria-controls="sub-filtros-resp" onclick="toggleAccordion(this, 'sub-filtros-resp')">
            <span class="icon">üë•</span><span class="label">Respons√°veis</span><span class="caret">‚ñæ</span>
          </button>
          <div id="sub-filtros-resp" class="submenu" role="region" aria-label="Respons√°veis">
            <fieldset style="border:0; padding:0; margin:0">
              <legend class="sr-only" style="position:absolute;left:-9999px">Respons√°veis</legend>
              <!-- PR√â-SELECIONADO: FABIO AMARAL -->
              <label class="row"><input type="radio" name="filtro-nome" value="FABIO AMARAL" checked><span class="label">FABIO AMARAL</span></label>
              <label class="row"><input type="radio" name="filtro-nome" value="GABRIEL SOUZA"><span class="label">GABRIEL SOUZA</span></label>
              <label class="row"><input type="radio" name="filtro-nome" value="MARCELO ALFREDO"><span class="label">MARCELO ALFREDO</span></label>
              <label class="row"><input type="radio" name="filtro-nome" value="ROMULO SALLA"><span class="label">ROMULO SALLA</span></label>
              <label class="row"><input type="radio" name="filtro-nome" value="TAINA SANTORO"><span class="label">TAINA SANTORO</span></label>
            </fieldset>
            <div class="actions">
              <button class="btn" type="button" onclick="aplicarFiltro()">Filtrar</button>
              <button class="btn secondary" type="button" onclick="limparFiltro()">Limpar</button>
            </div>
          </div>

          <!-- Futuramente: adicione novos subitens (Per√≠odo, Regi√£o, etc.) -->
        </div>
      </nav>
    </aside>

    <section class="stage" aria-label="√Årea do relat√≥rio">
      <div id="loading" class="loading">Carregando‚Ä¶</div>
      <!-- IN√çCIO J√Å FILTRADO EM 'FABIO AMARAL' -->
      <iframe
        id="reportFrame"
        class="report-frame"
        src="https://lookerstudio.google.com/embed/reporting/05f69128-cdfd-4e58-b570-1a6a54a25830/page/p_ronkgricwd?params=%7B%22ds56.param_responsaveis%22%3A%5B%22FABIO%20AMARAL%22%5D%7D"
        frameborder="0"
        allowfullscreen
        sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox">
      </iframe>
    </section>
  </div>

  <script>
    /* ============ CONFIG ============ */
    const PARAM_NAME = "ds56.param_responsaveis";
    const BASE_EMBED_URL = "https://lookerstudio.google.com/embed/reporting/05f69128-cdfd-4e58-b570-1a6a54a25830/page/p_ronkgricwd";
    const SEND_AS_ARRAY = true;
    const DEFAULT_NAME = "FABIO AMARAL"; // pr√©-selecionado e aplicado no load
    /* ================================= */

    const SPRING_EASE = 'cubic-bezier(.34,1.56,.64,1)';
    const SOFT_EASE   = 'cubic-bezier(.2,.8,.2,1)';

    function prefersReducedMotion(){
      return window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    }

    function toggleSidebar(btn){
      const app = document.getElementById('app');
      const isCollapsed = app.classList.toggle('collapsed');
      btn.setAttribute('aria-expanded', String(!isCollapsed));
    }

    function animateRowsReveal(panel){
      const rows = Array.from(panel.querySelectorAll('.row, .links a'));
      rows.forEach((row, i) => {
        row.animate(
          [
            { opacity: 0, transform: 'translateY(-8px)' },
            { opacity: 1, transform: 'translateY(0)' }
          ],
          { duration: 240, delay: 25*i, easing: SOFT_EASE, fill: 'forwards' }
        );
      });
    }

    function toggleAccordion(headerBtn, panelId){
      const panel = document.getElementById(panelId);
      const isOpen = headerBtn.getAttribute('aria-expanded') === 'true';
      headerBtn.setAttribute('aria-expanded', String(!isOpen));

      if (prefersReducedMotion()){
        panel.style.height = isOpen ? '0px' : 'auto';
        if (!isOpen){ panel.querySelectorAll('.row,.links a').forEach(r => { r.style.opacity = 1; r.style.transform = 'none'; }); }
        return;
      }

      const startHeight = panel.offsetHeight;
      panel.style.height = 'auto';
      const endHeight = panel.scrollHeight;
      panel.style.height = startHeight + 'px';

      if (!isOpen) animateRowsReveal(panel);

      const anim = panel.animate(
        [{ height: startHeight + 'px' }, { height: (isOpen ? 0 : endHeight) + 'px' }],
        { duration: isOpen ? 240 : 320, easing: isOpen ? SOFT_EASE : SPRING_EASE, fill: 'forwards' }
      );
      anim.onfinish = () => {
        if (isOpen){
          panel.style.height = '0px';
          panel.querySelectorAll('.row,.links a').forEach(r => { r.style.opacity = 0; r.style.transform = 'translateY(-6px)'; });
        } else {
          panel.style.height = 'auto';
        }
      };
    }

    function openAccordion(panelId, headerSelector){
      const panel = document.getElementById(panelId);
      const header = document.querySelector(headerSelector);
      if (!panel || !header) return;
      header.setAttribute('aria-expanded', 'true');
      panel.style.height = 'auto';
      panel.querySelectorAll('.row,.links a').forEach(r => { r.style.opacity = 1; r.style.transform = 'none'; });
    }

    function getNomeSelecionado(){
      const sel = document.querySelector('input[name="filtro-nome"]:checked');
      return sel ? sel.value : null;
    }

    function buildEmbedUrl(base, paramsObj){
      const url = new URL(base);
      url.searchParams.set('params', JSON.stringify(paramsObj));
      return url.toString();
    }

    function aplicarFiltro(){
      const nome = getNomeSelecionado();
      if (!nome){
        alert('Selecione um respons√°vel para filtrar.');
        return;
      }
      const value = SEND_AS_ARRAY ? [nome] : nome;
      const paramsObj = { [PARAM_NAME]: value };
      const iframe = document.getElementById('reportFrame');
      const finalUrl = buildEmbedUrl(BASE_EMBED_URL, paramsObj);
      iframe.src = finalUrl;
    }

    function limparFiltro(){
      document.querySelectorAll('input[name="filtro-nome"]').forEach(r => r.checked = false);
      // opcional: reverter para o padr√£o (DEFAULT_NAME) ao limpar
      const iframe = document.getElementById('reportFrame');
      const value = SEND_AS_ARRAY ? [DEFAULT_NAME] : DEFAULT_NAME;
      const paramsObj = { [PARAM_NAME]: value };
      iframe.src = buildEmbedUrl(BASE_EMBED_URL, paramsObj);
      // tamb√©m marca o r√°dio padr√£o
      const radio = document.querySelector(`input[name="filtro-nome"][value="${CSS.escape(DEFAULT_NAME)}"]`);
      if (radio) radio.checked = true;
    }

    function syncUIFromIframe(){
      const iframe = document.getElementById('reportFrame');
      try{
        const url = new URL(iframe.src);
        const raw = url.searchParams.get('params');
        if (!raw) return;
        const params = JSON.parse(raw);
        const val = params?.[PARAM_NAME];
        const nome = Array.isArray(val) ? val[0] : val;
        if (!nome) return;
        const radio = document.querySelector(`input[name="filtro-nome"][value="${CSS.escape(nome)}"]`);
        if (radio) radio.checked = true;
      }catch(e){ /* silencioso */ }
    }

    document.addEventListener('DOMContentLoaded', () => {
      // abrir todos os accordions
      openAccordion('sub-daily',   'button[aria-controls="sub-daily"]');
      openAccordion('sub-reports', 'button[aria-controls="sub-reports"]');
      openAccordion('sub-filtros', 'button[aria-controls="sub-filtros"]');
      openAccordion('sub-filtros-resp', 'button[aria-controls="sub-filtros-resp"]');

      // overlay de loading + sincroniza√ß√£o do r√°dio com o par√¢metro atual
      const iframe = document.getElementById('reportFrame');
      const loading = document.getElementById('loading');
      iframe.addEventListener('load', () => {
        loading?.remove();
        syncUIFromIframe();
      });

      // garante que o r√°dio padr√£o esteja marcado (fallback)
      const radio = document.querySelector(`input[name="filtro-nome"][value="${CSS.escape(DEFAULT_NAME)}"]`);
      if (radio) radio.checked = true;
    });
  </script>
</body>
</html>
